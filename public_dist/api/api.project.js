let ProjectModel=require("../model/project").ProjectModel,ResultResponse=require("../util/resultResponse"),FilesDelete=require("./api.file").FilesDelete,dataEncrypt=require("../util/crpyto").dataEncrypt;function getProject(e,t,r){try{t=t||0,r=r||1e3;var o={id:e};return Promise.all([ProjectModel.countDocuments(o).exec(),ProjectModel.find(o).sort({createDate:-1}).skip(Number(t)*r).limit(Number(r))]).then(e=>{var t=e[0],e=e[1];return new ResultResponse(200,dataEncrypt({total:t,project:e}))}).catch(e=>new ResultResponse(400,e,"project api Error"))}catch(e){throw new ResultResponse(400,e,"project api Error")}}function addProject(t,e){try{e.id=t;new ProjectModel(e).save();var r=new ResultResponse(200);return r}catch(e){t=new ResultResponse(404,e.stack,e.message);throw console.log("addProject",t),t}}function updateProject(t,e){try{var r={id:t,_id:e.projectId};return ProjectModel.updateOne(r,e).then(e=>new ResultResponse(200))}catch(e){t=new ResultResponse(404,e.stack,e.message);throw console.log("updateProject",t),t}}async function deleteProject(t,r){try{for(let e=0;e<r.length;e++){var o={id:t,_id:r[e]},c=await ProjectModel.findOne(o);if(!c)throw new ResultResponse(403,c,"projectInfo null");var{swiperFiles:n,attachedFiles:s}=c;if(await FilesDelete(t,[...n,...s]),await ProjectModel.deleteOne(o),e===r.length-1)return new ResultResponse(200)}}catch(e){console.log("err",e)}}function getProjectItem(t,e){try{var r={id:t,_id:e};return ProjectModel.findOne(r).then(e=>new ResultResponse(200,dataEncrypt(e))).catch(e=>new ResultResponse(403,e,"projectInfo null. itemKey error"))}catch(e){t=new ResultResponse(404,e.stack,e.message);throw console.log("getProjectItem",t),t}}module.exports={getProject:getProject,addProject:addProject,updateProject:updateProject,deleteProject:deleteProject,getProjectItem:getProjectItem};// build date : 2024. 12. 13. 오전 10:11:20